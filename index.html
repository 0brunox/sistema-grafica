<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o - Gr√°fica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .sidebar h2 {
            padding: 20px;
            background-color: #1a252f;
            font-size: 24px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            border-bottom: 1px solid #34495e;
        }

        .sidebar a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: background 0.3s;
        }

        .sidebar a:hover, .sidebar a.active {
            background-color: #34495e;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 8px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .close {
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }

        /* Status badges */
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Items table for quotes */
        .items-section {
            margin-top: 20px;
        }

        .add-item-btn {
            margin-bottom: 10px;
        }

        /* Print styles */
        @media print {
            .sidebar, .header, .btn, .no-print {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .card {
                box-shadow: none !important;
                break-inside: avoid;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Toggle Button for Mobile */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1001;
            background: #2c3e50;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>üìä Sistema Gr√°fica</h2>
        <ul>
            <li><a href="#" class="nav-link active" data-page="dashboard">Dashboard</a></li>
            <li><a href="#" class="nav-link" data-page="orcamentos">Or√ßamentos</a></li>
            <li><a href="#" class="nav-link" data-page="faturas">Faturas</a></li>
            <li><a href="#" class="nav-link" data-page="clientes">Clientes</a></li>
            <li><a href="#" class="nav-link" data-page="contas-receber">Contas a Receber</a></li>
            <li><a href="#" class="nav-link" data-page="contas-pagar">Contas a Pagar</a></li>
            <li><a href="#" class="nav-link" data-page="relatorios">Relat√≥rios</a></li>
            <li><a href="#" class="nav-link" data-page="perfil">‚öôÔ∏è Perfil da Empresa</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page">
            <div class="header">
                <h1>Dashboard</h1>
                <div>
                    <span id="current-date"></span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Or√ßamentos do M√™s</h3>
                    <div class="value" id="orcamentos-mes">0</div>
                </div>
                <div class="stat-card">
                    <h3>Faturas Pendentes</h3>
                    <div class="value" id="faturas-pendentes">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total a Receber</h3>
                    <div class="value" id="total-receber">R$ 0,00</div>
                </div>
                <div class="stat-card">
                    <h3>Total a Pagar</h3>
                    <div class="value" id="total-pagar">R$ 0,00</div>
                </div>
                <div class="stat-card">
                    <h3>Total Recebido no M√™s</h3>
                    <div class="value" id="total-recebido-mes">R$ 0,00</div>
                </div>
            </div>

            <div class="card">
                <h2>√öltimos Or√ßamentos</h2>
                <table id="dashboard-orcamentos">
                    <thead>
                        <tr>
                            <th>N√∫mero</th>
                            <th>Cliente</th>
                            <th>Data</th>
                            <th>Valor</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Or√ßamentos Page -->
        <div id="orcamentos-page" class="page" style="display: none;">
            <div class="header">
                <h1>Or√ßamentos</h1>
                <button class="btn btn-primary" onclick="showModal('orcamento-modal')">+ Novo Or√ßamento</button>
            </div>

            <div class="card">
                <table id="orcamentos-table">
                    <thead>
                        <tr>
                            <th>N√∫mero</th>
                            <th>Cliente</th>
                            <th>Data</th>
                            <th>Validade</th>
                            <th>Valor Total</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Faturas Page -->
        <div id="faturas-page" class="page" style="display: none;">
            <div class="header">
                <h1>Faturas</h1>
                <button class="btn btn-primary" onclick="showModal('fatura-modal')">+ Nova Fatura</button>
            </div>

            <div class="card">
                <table id="faturas-table">
                    <thead>
                        <tr>
                            <th>N√∫mero</th>
                            <th>Cliente</th>
                            <th>Data</th>
                            <th>Vencimento</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Clientes Page -->
        <div id="clientes-page" class="page" style="display: none;">
            <div class="header">
                <h1>Clientes</h1>
                <button class="btn btn-primary" onclick="showModal('cliente-modal')">+ Novo Cliente</button>
            </div>

            <div class="card">
                <table id="clientes-table">
                    <thead>
                        <tr>
                            <th>Nome/Raz√£o Social</th>
                            <th>CNPJ/CPF</th>
                            <th>Telefone</th>
                            <th>Email</th>
                            <th>Cidade</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Contas a Receber Page -->
        <div id="contas-receber-page" class="page" style="display: none;">
            <div class="header">
                <h1>Contas a Receber</h1>
            </div>

            <div class="card">
                <table id="contas-receber-table">
                    <thead>
                        <tr>
                            <th>Fatura</th>
                            <th>Cliente</th>
                            <th>Vencimento</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Contas a Pagar Page -->
        <div id="contas-pagar-page" class="page" style="display: none;">
            <div class="header">
                <h1>Contas a Pagar</h1>
                <button class="btn btn-primary" onclick="showModal('conta-pagar-modal')">+ Nova Conta</button>
            </div>

            <div class="card">
                <table id="contas-pagar-table">
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>Fornecedor</th>
                            <th>Vencimento</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Relat√≥rios Page -->
        <div id="relatorios-page" class="page" style="display: none;">
            <div class="header">
                <h1>Relat√≥rios</h1>
            </div>

            <div class="stats-grid">
                <div class="card">
                    <h3>Relat√≥rio de Vendas</h3>
                    <p>Visualize o desempenho de vendas por per√≠odo</p>
                    <button class="btn btn-primary" onclick="gerarRelatorioVendas()">Gerar Relat√≥rio</button>
                </div>
                <div class="card">
                    <h3>Fluxo de Caixa</h3>
                    <p>Acompanhe entradas e sa√≠das</p>
                    <button class="btn btn-primary" onclick="gerarFluxoCaixa()">Gerar Relat√≥rio</button>
                </div>
                <div class="card">
                    <h3>Clientes</h3>
                    <p>Relat√≥rio completo de clientes</p>
                    <button class="btn btn-primary" onclick="gerarRelatorioClientes()">Gerar Relat√≥rio</button>
                </div>
            </div>
        </div>
        <!-- Perfil Page -->
        <div id="perfil-page" class="page" style="display: none;">
            <div class="header">
                <h1>Perfil da Empresa</h1>
            </div>

            <div class="card">
                <form id="perfil-form">
                    <div class="stats-grid" style="grid-template-columns: 1fr 1fr;">
                        <div>
                            <h3 style="margin-bottom: 20px;">Dados da Empresa</h3>
                            
                            <div class="form-group">
                                <label>Nome da Organiza√ß√£o*</label>
                                <input type="text" name="nome" required placeholder="Fast Brand Comunica√ß√£o Visual">
                            </div>
                            
                            <div class="form-group">
                                <label>CNPJ</label>
                                <input type="text" name="cnpj" placeholder="00.000.000/0000-00">
                            </div>
                            
                            <div class="form-group">
                                <label>Ind√∫stria</label>
                                <select name="industria">
                                    <option value="grafica">Gr√°fica</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="comunicacao">Comunica√ß√£o Visual</option>
                                    <option value="publicidade">Publicidade</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Website</label>
                                <input type="url" name="website" placeholder="https://fastbrand.com.br">
                            </div>
                            
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="email" placeholder="contato@fastbrand.com.br">
                            </div>
                            
                            <div class="form-group">
                                <label>Telefone</label>
                                <input type="text" name="telefone" placeholder="(21) 4042-4222">
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="margin-bottom: 20px;">Endere√ßo</h3>
                            
                            <div class="form-group">
                                <label>Endere√ßo</label>
                                <input type="text" name="endereco" placeholder="Rua Francisco de Sousa, 106">
                            </div>
                            
                            <div class="form-group">
                                <label>Bairro</label>
                                <input type="text" name="bairro" placeholder="Bento Ribeiro">
                            </div>
                            
                            <div class="form-group">
                                <label>Cidade</label>
                                <input type="text" name="cidade" placeholder="Rio de Janeiro">
                            </div>
                            
                            <div class="form-group">
                                <label>Estado</label>
                                <select name="estado">
                                    <option value="">Selecione</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amap√°</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Cear√°</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Esp√≠rito Santo</option>
                                    <option value="GO">Goi√°s</option>
                                    <option value="MA">Maranh√£o</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Par√°</option>
                                    <option value="PB">Para√≠ba</option>
                                    <option value="PR">Paran√°</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piau√≠</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rond√¥nia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">S√£o Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>CEP</label>
                                <input type="text" name="cep" placeholder="21331-180">
                            </div>
                            
                            <div class="form-group">
                                <label>Pa√≠s</label>
                                <select name="pais">
                                    <option value="Brasil">Brasil</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Fax</label>
                                <input type="text" name="fax" placeholder="N√∫mero do fax (opcional)">
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 20px;">Configura√ß√µes do Sistema</h3>
                        <div class="form-group">
                            <label>Prefixo dos Or√ßamentos</label>
                            <input type="text" name="prefixo_orcamento" placeholder="N¬∞" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label>Pr√≥ximo N√∫mero de Or√ßamento</label>
                            <input type="number" name="proximo_orcamento" min="1">
                        </div>
                        <div class="form-group">
                            <label>Pr√≥ximo N√∫mero de Fatura</label>
                            <input type="number" name="proximo_fatura" min="1">
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary">üíæ Salvar Altera√ß√µes</button>
                        <button type="button" class="btn btn-success" onclick="exportData()">üì• Exportar Dados</button>
                        <button type="button" class="btn btn-warning" onclick="importData()">üì§ Importar Dados</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Cliente Modal -->
    <div id="cliente-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="cliente-modal-title">Novo Cliente</h2>
                <span class="close" onclick="closeModal('cliente-modal')">√ó</span>
            </div>
            <form id="cliente-form">
                <div class="form-group">
                    <label>Nome/Raz√£o Social*</label>
                    <input type="text" name="nome" required>
                </div>
                <div class="form-group">
                    <label>CNPJ/CPF</label>
                    <input type="text" name="documento">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" name="telefone">
                </div>
                <div class="form-group">
                    <label>Endere√ßo</label>
                    <input type="text" name="endereco">
                </div>
                <div class="form-group">
                    <label>Cidade</label>
                    <input type="text" name="cidade">
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <input type="text" name="estado">
                </div>
                <button type="submit" class="btn btn-primary">Salvar Cliente</button>
            </form>
        </div>
    </div>

    <!-- Or√ßamento Modal -->
    <div id="orcamento-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Or√ßamento</h2>
                <span class="close" onclick="closeModal('orcamento-modal')">√ó</span>
            </div>
            <form id="orcamento-form">
                <div class="form-group">
                    <label>Cliente*</label>
                    <div style="display: flex; gap: 10px;">
                        <select name="cliente" required style="flex: 1;">
                            <option value="">Selecione um cliente</option>
                        </select>
                        <button type="button" class="btn btn-success" onclick="showQuickClientForm()">+ Novo Cliente</button>
                    </div>
                    <div id="quick-client-form" style="display: none; margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
                        <h4>Cadastro R√°pido de Cliente</h4>
                        <input type="text" id="quick-client-name" placeholder="Nome/Raz√£o Social*" style="margin-bottom: 10px;">
                        <input type="text" id="quick-client-doc" placeholder="CNPJ/CPF" style="margin-bottom: 10px;">
                        <input type="email" id="quick-client-email" placeholder="Email" style="margin-bottom: 10px;">
                        <input type="text" id="quick-client-phone" placeholder="Telefone" style="margin-bottom: 10px;">
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-primary" onclick="saveQuickClient()">Salvar</button>
                            <button type="button" class="btn btn-danger" onclick="hideQuickClientForm()">Cancelar</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" name="data" required>
                </div>
                <div class="form-group">
                    <label>Validade (dias)</label>
                    <input type="number" name="validade" value="30" required>
                </div>
                <div class="form-group">
                    <label>Prazo de Entrega</label>
                    <input type="text" name="prazo_entrega" placeholder="Ex: 3 a 5 dias √∫teis">
                </div>
                
                <div class="items-section">
                    <h3>Itens do Or√ßamento</h3>
                    <button type="button" class="btn btn-success add-item-btn" onclick="addItem()">+ Adicionar Item</button>
                    <table id="items-table">
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Qtd</th>
                                <th>Largura</th>
                                <th>Altura</th>
                                <th>M¬≤</th>
                                <th>R$/M¬≤</th>
                                <th>Valor Unit.</th>
                                <th>Total</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea name="observacoes"></textarea>
                </div>

                <div class="form-group">
                    <h3>Total: R$ <span id="orcamento-total">0,00</span></h3>
                </div>

                <button type="submit" class="btn btn-primary">Salvar Or√ßamento</button>
            </form>
        </div>
    </div>

    <!-- Fatura Modal -->
    <div id="fatura-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="fatura-modal-title">Nova Fatura</h2>
                <span class="close" onclick="closeModal('fatura-modal')">√ó</span>
            </div>
            <form id="fatura-form">
                <div class="form-group">
                    <label>Cliente*</label>
                    <select name="cliente" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data de Emiss√£o</label>
                    <input type="date" name="data_emissao" required>
                </div>
                <div class="form-group">
                    <label>Prazo de Pagamento</label>
                    <select name="prazo_pagamento" required>
                        <option value="0">A Vista</option>
                        <option value="7">7 dias</option>
                        <option value="15">15 dias</option>
                        <option value="30">30 dias</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data de Vencimento</label>
                    <input type="date" name="data_vencimento" required>
                </div>
                <div class="form-group">
                    <label>Forma de Pagamento</label>
                    <select name="forma_pagamento">
                        <option value="transferencia">Dep√≥sito Banc√°rio</option>
                        <option value="pix">PIX</option>
                        <option value="boleto">Boleto</option>
                        <option value="cartao">Cart√£o de Cr√©dito</option>
                        <option value="cripto">Criptomoedas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor Total</label>
                    <input type="number" name="valor" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea name="descricao" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Salvar Fatura</button>
            </form>
        </div>
    </div>

    <!-- Convert to Fatura Modal -->
    <div id="convert-fatura-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Converter para Fatura</h2>
                <span class="close" onclick="closeModal('convert-fatura-modal')">√ó</span>
            </div>
            <form id="convert-fatura-form">
                <input type="hidden" name="orcamento_id">
                <div class="form-group">
                    <label>Prazo de Pagamento*</label>
                    <select name="prazo_pagamento" required onchange="updateVencimento()">
                        <option value="0">A Vista</option>
                        <option value="7">7 dias</option>
                        <option value="15">15 dias</option>
                        <option value="30">30 dias</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data de Vencimento</label>
                    <input type="date" name="data_vencimento" required>
                </div>
                <div class="form-group">
                    <label>Forma de Pagamento*</label>
                    <select name="forma_pagamento" required>
                        <option value="transferencia">Dep√≥sito Banc√°rio</option>
                        <option value="pix">PIX</option>
                        <option value="boleto">Boleto</option>
                        <option value="cartao">Cart√£o de Cr√©dito</option>
                        <option value="cripto">Criptomoedas</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Gerar Fatura</button>
            </form>
        </div>
    </div>

    <!-- Conta a Pagar Modal -->
    <div id="conta-pagar-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="conta-pagar-modal-title">Nova Conta a Pagar</h2>
                <span class="close" onclick="closeModal('conta-pagar-modal')">√ó</span>
            </div>
            <form id="conta-pagar-form">
                <div class="form-group">
                    <label>Descri√ß√£o*</label>
                    <input type="text" name="descricao" required>
                </div>
                <div class="form-group">
                    <label>Fornecedor</label>
                    <input type="text" name="fornecedor">
                </div>
                <div class="form-group">
                    <label>Vencimento</label>
                    <input type="date" name="vencimento" required>
                </div>
                <div class="form-group">
                    <label>Valor</label>
                    <input type="number" name="valor" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select name="categoria">
                        <option value="material">Material</option>
                        <option value="servico">Servi√ßo</option>
                        <option value="aluguel">Aluguel</option>
                        <option value="energia">Energia</option>
                        <option value="agua">√Ågua</option>
                        <option value="telefone">Telefone/Internet</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Salvar Conta</button>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let db = {
            clientes: [],
            orcamentos: [],
            faturas: [],
            contasPagar: [],
            nextOrcamentoNum: 137703,
            nextFaturaNum: 1001,
            empresa: {
                nome: 'Fast Brand Comunica√ß√£o Visual',
                cnpj: '17.468.809/0001-45',
                industria: 'marketing',
                website: 'https://fastbrand.com.br',
                email: 'contato@fastbrand.com.br',
                telefone: '21 4042 4222',
                endereco: 'Rua Francisco de Sousa, 106',
                bairro: 'Bento Ribeiro',
                cidade: 'Rio de Janeiro',
                estado: 'RJ',
                cep: '21331-180',
                pais: 'Brasil',
                fax: '',
                prefixo_orcamento: 'N¬∞'
            }
        };

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('graficaDB');
            if (savedData) {
                db = JSON.parse(savedData);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('graficaDB', JSON.stringify(db));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateCurrentDate();
            updateDashboard();
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                    
                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Forms
            document.getElementById('cliente-form').addEventListener('submit', saveCliente);
            document.getElementById('orcamento-form').addEventListener('submit', saveOrcamento);
            document.getElementById('fatura-form').addEventListener('submit', saveFatura);
            document.getElementById('conta-pagar-form').addEventListener('submit', saveContaPagar);
            document.getElementById('perfil-form').addEventListener('submit', savePerfil);
            document.getElementById('convert-fatura-form').addEventListener('submit', convertToFaturaSubmit);
            
            // Load company profile
            loadPerfil();
            
            // Show dashboard by default
            showPage('dashboard');
        });

        // Update current date
        function updateCurrentDate() {
            const date = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = date.toLocaleDateString('pt-BR', options);
        }

        // Show page
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            
            const page = document.getElementById(`${pageName}-page`);
            if (page) {
                page.style.display = 'block';
                
                // Load page data
                switch(pageName) {
                    case 'dashboard':
                        updateDashboard();
                        break;
                    case 'clientes':
                        loadClientes();
                        break;
                    case 'orcamentos':
                        loadOrcamentos();
                        break;
                    case 'faturas':
                        loadFaturas();
                        break;
                    case 'contas-receber':
                        loadContasReceber();
                        break;
                    case 'contas-pagar':
                        loadContasPagar();
                        break;
                    case 'perfil':
                        loadPerfil();
                        break;
                }
            }
        }

        // Modal functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            
            // Load clientes in select
            if (modalId === 'orcamento-modal' || modalId === 'fatura-modal') {
                const select = modal.querySelector('select[name="cliente"]');
                select.innerHTML = '<option value="">Selecione um cliente</option>';
                db.clientes.forEach(cliente => {
                    select.innerHTML += `<option value="${cliente.id}">${cliente.nome}</option>`;
                });
            }
            
            // Set today's date for new records only
            if (modalId === 'orcamento-modal' && !document.getElementById('orcamento-form').hasAttribute('data-edit-id')) {
                const dateInputs = modal.querySelectorAll('input[type="date"]');
                const today = new Date().toISOString().split('T')[0];
                dateInputs.forEach(input => {
                    if (input.name === 'data' || input.name === 'data_emissao') {
                        input.value = today;
                    }
                });
            }

            if (modalId === 'fatura-modal' && !document.getElementById('fatura-form').hasAttribute('data-edit-id')) {
                const today = new Date().toISOString().split('T')[0];
                document.querySelector('#fatura-modal input[name="data_emissao"]').value = today;
                document.querySelector('#fatura-modal input[name="data_vencimento"]').value = today;
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            
            // Reset form if it's orcamento modal
            if (modalId === 'orcamento-modal') {
                const form = document.getElementById('orcamento-form');
                form.removeAttribute('data-edit-id');
                document.querySelector('#orcamento-modal .modal-header h2').textContent = 'Novo Or√ßamento';
            }
            // Reset title for cliente modal
            if (modalId === 'cliente-modal') {
                document.getElementById('cliente-modal-title').textContent = 'Novo Cliente';
                document.getElementById('cliente-form').removeAttribute('data-edit-id');
            }
            // Reset title for fatura modal
            if (modalId === 'fatura-modal') {
                document.getElementById('fatura-modal-title').textContent = 'Nova Fatura';
                document.getElementById('fatura-form').removeAttribute('data-edit-id');
            }
            // Reset title for conta-pagar modal
            if (modalId === 'conta-pagar-modal') {
                document.getElementById('conta-pagar-modal-title').textContent = 'Nova Conta a Pagar';
                document.getElementById('conta-pagar-form').removeAttribute('data-edit-id');
            }
        }

        // Sidebar toggle for mobile
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        // Cliente functions
        function saveCliente(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const editId = e.target.getAttribute('data-edit-id');
            const cliente = {
                id: editId ? parseInt(editId) : Date.now(),
                nome: formData.get('nome'),
                documento: formData.get('documento'),
                email: formData.get('email'),
                telefone: formData.get('telefone'),
                endereco: formData.get('endereco'),
                cidade: formData.get('cidade'),
                estado: formData.get('estado')
            };
            
            if (editId) {
                const index = db.clientes.findIndex(c => c.id === cliente.id);
                if (index !== -1) {
                    db.clientes[index] = cliente;
                }
                showNotification('Cliente atualizado com sucesso!');
            } else {
                db.clientes.push(cliente);
                showNotification('Cliente cadastrado com sucesso!');
            }
            
            saveData();
            closeModal('cliente-modal');
            e.target.reset();
            loadClientes();
        }

        function loadClientes() {
            const tbody = document.querySelector('#clientes-table tbody');
            tbody.innerHTML = '';
            
            db.clientes.forEach(cliente => {
                tbody.innerHTML += `
                    <tr>
                        <td>${cliente.nome}</td>
                        <td>${cliente.documento || '-'}</td>
                        <td>${cliente.telefone || '-'}</td>
                        <td>${cliente.email || '-'}</td>
                        <td>${cliente.cidade || '-'}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editCliente(${cliente.id})">Editar</button>
                            <button class="btn btn-danger" onclick="deleteCliente(${cliente.id})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editCliente(id) {
            const cliente = db.clientes.find(c => c.id === id);
            if (!cliente) return;

            showModal('cliente-modal');
            document.getElementById('cliente-modal-title').textContent = 'Editar Cliente';
            const form = document.getElementById('cliente-form');
            form.setAttribute('data-edit-id', id);
            form.nome.value = cliente.nome;
            form.documento.value = cliente.documento || '';
            form.email.value = cliente.email || '';
            form.telefone.value = cliente.telefone || '';
            form.endereco.value = cliente.endereco || '';
            form.cidade.value = cliente.cidade || '';
            form.estado.value = cliente.estado || '';
        }

        // Or√ßamento functions
        let itemCount = 0;

        function showQuickClientForm() {
            document.getElementById('quick-client-form').style.display = 'block';
        }

        function hideQuickClientForm() {
            document.getElementById('quick-client-form').style.display = 'none';
            document.getElementById('quick-client-name').value = '';
            document.getElementById('quick-client-doc').value = '';
            document.getElementById('quick-client-email').value = '';
            document.getElementById('quick-client-phone').value = '';
        }

        function saveQuickClient() {
            const name = document.getElementById('quick-client-name').value;
            if (!name) {
                alert('Por favor, preencha o nome do cliente');
                return;
            }

            const cliente = {
                id: Date.now(),
                nome: name,
                documento: document.getElementById('quick-client-doc').value,
                email: document.getElementById('quick-client-email').value,
                telefone: document.getElementById('quick-client-phone').value,
                endereco: '',
                cidade: '',
                estado: ''
            };

            db.clientes.push(cliente);
            saveData();

            // Update select
            const select = document.querySelector('#orcamento-modal select[name="cliente"]');
            const option = document.createElement('option');
            option.value = cliente.id;
            option.textContent = cliente.nome;
            option.selected = true;
            select.appendChild(option);

            hideQuickClientForm();
            showNotification('Cliente cadastrado com sucesso!');
        }

        function addItem() {
            const tbody = document.querySelector('#items-table tbody');
            itemCount++;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" name="item_descricao_${itemCount}" required></td>
                <td><input type="number" name="item_qtd_${itemCount}" value="1" min="1" onchange="calculateItemTotal(${itemCount})"></td>
                <td><input type="number" name="item_largura_${itemCount}" step="0.01" onchange="calculateItemTotal(${itemCount})"></td>
                <td><input type="number" name="item_altura_${itemCount}" step="0.01" onchange="calculateItemTotal(${itemCount})"></td>
                <td><span id="item_m2_${itemCount}">0,00</span></td>
                <td><input type="number" name="item_preco_m2_${itemCount}" step="0.01" placeholder="0,00" onchange="calculateItemTotal(${itemCount})"></td>
                <td><input type="number" name="item_valor_${itemCount}" step="0.01" onchange="calculateItemTotal(${itemCount}, true)"></td>
                <td><span id="item_total_${itemCount}">0,00</span></td>
                <td><button type="button" class="btn btn-danger" onclick="removeItem(this)">X</button></td>
            `;
            
            tbody.appendChild(row);
        }

        function removeItem(button) {
            button.closest('tr').remove();
            calculateTotal();
        }

        function calculateItemTotal(itemNum, fromUnitValue = false) {
            const qtd = parseFloat(document.querySelector(`input[name="item_qtd_${itemNum}"]`).value) || 0;
            const largura = parseFloat(document.querySelector(`input[name="item_largura_${itemNum}"]`).value) || 0;
            const altura = parseFloat(document.querySelector(`input[name="item_altura_${itemNum}"]`).value) || 0;
            const precoM2 = parseFloat(document.querySelector(`input[name="item_preco_m2_${itemNum}"]`).value) || 0;
            const valorUnit = parseFloat(document.querySelector(`input[name="item_valor_${itemNum}"]`).value) || 0;
            
            // Calculate M¬≤
            const m2 = largura * altura;
            document.getElementById(`item_m2_${itemNum}`).textContent = m2.toFixed(2).replace('.', ',');
            
            let total = 0;
            
            if (!fromUnitValue && precoM2 > 0 && m2 > 0) {
                // Calculate from M¬≤ price
                const unitValue = m2 * precoM2;
                document.querySelector(`input[name="item_valor_${itemNum}"]`).value = unitValue.toFixed(2);
                total = qtd * unitValue;
            } else {
                // Calculate from unit value
                total = qtd * valorUnit;
            }
            
            document.getElementById(`item_total_${itemNum}`).textContent = formatCurrency(total);
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            for (let i = 1; i <= itemCount; i++) {
                const totalElement = document.getElementById(`item_total_${i}`);
                if (totalElement) {
                    const value = parseFloat(totalElement.textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                    total += value;
                }
            }
            document.getElementById('orcamento-total').textContent = formatCurrency(total);
        }

        function editOrcamento(id) {
            const orcamento = db.orcamentos.find(o => o.id === id);
            if (!orcamento) return;

            // Show modal
            showModal('orcamento-modal');
            
            // Change modal title
            document.querySelector('#orcamento-modal .modal-header h2').textContent = 'Editar Or√ßamento';
            
            // Fill form fields
            const form = document.getElementById('orcamento-form');
            form.setAttribute('data-edit-id', id);
            
            // Set cliente
            form.querySelector('select[name="cliente"]').value = orcamento.clienteId;
            
            // Set dates and other fields
            form.querySelector('input[name="data"]').value = orcamento.data;
            form.querySelector('input[name="validade"]').value = orcamento.validade;
            form.querySelector('input[name="prazo_entrega"]').value = orcamento.prazoEntrega || '';
            form.querySelector('textarea[name="observacoes"]').value = orcamento.observacoes || '';
            
            // Clear existing items
            document.querySelector('#items-table tbody').innerHTML = '';
            itemCount = 0;
            
            // Add existing items
            orcamento.items.forEach(item => {
                itemCount++;
                const tbody = document.querySelector('#items-table tbody');
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td><input type="text" name="item_descricao_${itemCount}" value="${item.descricao}" required></td>
                    <td><input type="number" name="item_qtd_${itemCount}" value="${item.qtd}" min="1" onchange="calculateItemTotal(${itemCount})"></td>
                    <td><input type="number" name="item_largura_${itemCount}" value="${item.largura || ''}" step="0.01" onchange="calculateItemTotal(${itemCount})"></td>
                    <td><input type="number" name="item_altura_${itemCount}" value="${item.altura || ''}" step="0.01" onchange="calculateItemTotal(${itemCount})"></td>
                    <td><span id="item_m2_${itemCount}">${item.m2 ? item.m2.toFixed(2).replace('.', ',') : '0,00'}</span></td>
                    <td><input type="number" name="item_preco_m2_${itemCount}" value="${item.precoM2 || ''}" step="0.01" placeholder="0,00" onchange="calculateItemTotal(${itemCount})"></td>
                    <td><input type="number" name="item_valor_${itemCount}" value="${item.valorUnit}" step="0.01" onchange="calculateItemTotal(${itemCount}, true)"></td>
                    <td><span id="item_total_${itemCount}">${formatCurrency(item.total)}</span></td>
                    <td><button type="button" class="btn btn-danger" onclick="removeItem(this)">X</button></td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Calculate total
            calculateTotal();
        }

        function saveOrcamento(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const editId = e.target.getAttribute('data-edit-id');
            
            // Collect items
            const items = [];
            let total = 0;
            
            for (let i = 1; i <= itemCount; i++) {
                const descricao = formData.get(`item_descricao_${i}`);
                if (descricao) {
                    const qtd = parseFloat(formData.get(`item_qtd_${i}`)) || 0;
                    const largura = parseFloat(formData.get(`item_largura_${i}`)) || 0;
                    const altura = parseFloat(formData.get(`item_altura_${i}`)) || 0;
                    const precoM2 = parseFloat(formData.get(`item_preco_m2_${i}`)) || 0;
                    const valorUnit = parseFloat(formData.get(`item_valor_${i}`)) || 0;
                    const m2 = largura * altura;
                    
                    let itemTotal = qtd * valorUnit;
                    
                    items.push({
                        descricao,
                        qtd,
                        largura,
                        altura,
                        m2,
                        precoM2,
                        valorUnit,
                        total: itemTotal
                    });
                    
                    total += itemTotal;
                }
            }
            
            if (editId) {
                // Edit existing
                const index = db.orcamentos.findIndex(o => o.id === parseInt(editId));
                if (index !== -1) {
                    db.orcamentos[index] = {
                        ...db.orcamentos[index],
                        clienteId: formData.get('cliente'),
                        data: formData.get('data'),
                        validade: parseInt(formData.get('validade')),
                        prazoEntrega: formData.get('prazo_entrega'),
                        items: items,
                        total: total,
                        observacoes: formData.get('observacoes')
                    };
                }
                e.target.removeAttribute('data-edit-id');
                showNotification('Or√ßamento atualizado com sucesso!');
            } else {
                // Create new
                const orcamento = {
                    id: Date.now(),
                    numero: (db.empresa.prefixo_orcamento || 'N¬∞') + db.nextOrcamentoNum++,
                    clienteId: formData.get('cliente'),
                    data: formData.get('data'),
                    validade: parseInt(formData.get('validade')),
                    prazoEntrega: formData.get('prazo_entrega'),
                    items: items,
                    total: total,
                    observacoes: formData.get('observacoes'),
                    status: 'pendente'
                };
                
                db.orcamentos.push(orcamento);
                showNotification('Or√ßamento criado com sucesso!');
            }
            
            saveData();
            closeModal('orcamento-modal');
            e.target.reset();
            document.querySelector('#orcamento-modal .modal-header h2').textContent = 'Novo Or√ßamento';
            itemCount = 0;
            document.querySelector('#items-table tbody').innerHTML = '';
            loadOrcamentos();
        }

        function loadOrcamentos() {
            const tbody = document.querySelector('#orcamentos-table tbody');
            tbody.innerHTML = '';
            
            db.orcamentos.forEach(orcamento => {
                const cliente = db.clientes.find(c => c.id == orcamento.clienteId);
                const dataValidade = new Date(orcamento.data);
                dataValidade.setDate(dataValidade.getDate() + orcamento.validade);
                
                tbody.innerHTML += `
                    <tr>
                        <td>${orcamento.numero}</td>
                        <td>${cliente ? cliente.nome : '-'}</td>
                        <td>${formatDate(orcamento.data)}</td>
                        <td>${formatDate(dataValidade)}</td>
                        <td>${formatCurrency(orcamento.total)}</td>
                        <td><span class="badge badge-${getStatusClass(orcamento.status)}">${getStatusText(orcamento.status)}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="viewOrcamento(${orcamento.id})">Ver</button>
                            <button class="btn btn-primary" onclick="editOrcamento(${orcamento.id})">Editar</button>
                            <button class="btn btn-success" onclick="showConvertModal(${orcamento.id})">Faturar</button>
                            <button class="btn btn-danger" onclick="deleteOrcamento(${orcamento.id})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function showConvertModal(orcamentoId) {
            showModal('convert-fatura-modal');
            const form = document.getElementById('convert-fatura-form');
            form.orcamento_id.value = orcamentoId;
            updateVencimento();
        }

        function updateVencimento() {
            const form = document.getElementById('convert-fatura-form') || document.getElementById('fatura-form');
            if (!form) return;
            const prazo = parseInt(form.querySelector('select[name="prazo_pagamento"]').value) || 0;
            const today = new Date();
            const vencimento = new Date(today.getTime() + prazo * 24 * 60 * 60 * 1000);
            form.querySelector('input[name="data_vencimento"]').value = vencimento.toISOString().split('T')[0];
        }

        function convertToFaturaSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const orcamentoId = parseInt(formData.get('orcamento_id'));
            const orcamento = db.orcamentos.find(o => o.id === orcamentoId);
            if (orcamento) {
                const fatura = {
                    id: Date.now(),
                    numero: 'F' + db.nextFaturaNum++,
                    orcamentoId: orcamentoId,
                    clienteId: orcamento.clienteId,
                    dataEmissao: new Date().toISOString().split('T')[0],
                    dataVencimento: formData.get('data_vencimento'),
                    valor: orcamento.total,
                    descricao: `Fatura referente ao or√ßamento ${orcamento.numero}`,
                    status: 'pendente',
                    formaPagamento: formData.get('forma_pagamento')
                };
                
                db.faturas.push(fatura);
                orcamento.status = 'aprovado';
                saveData();
                showNotification('Or√ßamento convertido em fatura com sucesso!');
                closeModal('convert-fatura-modal');
                loadOrcamentos();
            }
        }

        function viewOrcamento(id) {
            const orcamento = db.orcamentos.find(o => o.id === id);
            if (orcamento) {
                generateOrcamentoPDF(orcamento);
            }
        }

        // Fatura functions
        function saveFatura(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const editId = e.target.getAttribute('data-edit-id');
            
            const fatura = {
                id: editId ? parseInt(editId) : Date.now(),
                numero: editId ? db.faturas.find(f => f.id === parseInt(editId)).numero : 'F' + db.nextFaturaNum++,
                clienteId: formData.get('cliente'),
                dataEmissao: formData.get('data_emissao'),
                dataVencimento: formData.get('data_vencimento'),
                valor: parseFloat(formData.get('valor')),
                descricao: formData.get('descricao'),
                formaPagamento: formData.get('forma_pagamento'),
                status: 'pendente'
            };
            
            if (editId) {
                const index = db.faturas.findIndex(f => f.id === fatura.id);
                if (index !== -1) {
                    db.faturas[index] = fatura;
                }
                showNotification('Fatura atualizada com sucesso!');
            } else {
                db.faturas.push(fatura);
                showNotification('Fatura criada com sucesso!');
            }
            
            saveData();
            closeModal('fatura-modal');
            e.target.reset();
            loadFaturas();
        }

        function loadFaturas() {
            const tbody = document.querySelector('#faturas-table tbody');
            tbody.innerHTML = '';
            
            db.faturas.forEach(fatura => {
                const cliente = db.clientes.find(c => c.id == fatura.clienteId);
                
                tbody.innerHTML += `
                    <tr>
                        <td>${fatura.numero}</td>
                        <td>${cliente ? cliente.nome : '-'}</td>
                        <td>${formatDate(fatura.dataEmissao)}</td>
                        <td>${formatDate(fatura.dataVencimento)}</td>
                        <td>${formatCurrency(fatura.valor)}</td>
                        <td><span class="badge badge-${getStatusClass(fatura.status)}">${getStatusText(fatura.status)}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="viewFatura(${fatura.id})">Ver</button>
                            <button class="btn btn-primary" onclick="editFatura(${fatura.id})">Editar</button>
                            <button class="btn btn-success" onclick="markAsPaid(${fatura.id})">Receber</button>
                            <button class="btn btn-danger" onclick="deleteFatura(${fatura.id})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editFatura(id) {
            const fatura = db.faturas.find(f => f.id === id);
            if (!fatura) return;

            showModal('fatura-modal');
            document.getElementById('fatura-modal-title').textContent = 'Editar Fatura';
            const form = document.getElementById('fatura-form');
            form.setAttribute('data-edit-id', id);
            form.querySelector('select[name="cliente"]').value = fatura.clienteId;
            form.querySelector('input[name="data_emissao"]').value = fatura.dataEmissao;
            const prazo = Math.round((new Date(fatura.dataVencimento) - new Date(fatura.dataEmissao)) / (24 * 60 * 60 * 1000));
            form.querySelector('select[name="prazo_pagamento"]').value = prazo;
            form.querySelector('input[name="data_vencimento"]').value = fatura.dataVencimento;
            form.querySelector('select[name="forma_pagamento"]').value = fatura.formaPagamento;
            form.querySelector('input[name="valor"]').value = fatura.valor;
            form.querySelector('textarea[name="descricao"]').value = fatura.descricao;
        }

        function markAsPaid(faturaId) {
            const fatura = db.faturas.find(f => f.id === faturaId);
            if (fatura && confirm('Confirmar recebimento desta fatura?')) {
                fatura.status = 'pago';
                fatura.dataPagamento = new Date().toISOString().split('T')[0];
                saveData();
                loadFaturas();
                updateDashboard();
                showNotification('Fatura marcada como paga!');
            }
        }

        function viewFatura(id) {
            const fatura = db.faturas.find(f => f.id === id);
            if (fatura) {
                generateFaturaPDF(fatura);
            }
        }

        // Generate Fatura PDF
        function generateFaturaPDF(fatura) {
            const cliente = db.clientes.find(c => c.id == fatura.clienteId);
            
            // Create print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Fatura ${fatura.numero}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .company-info { margin-bottom: 30px; }
                        .client-info { margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f5f5f5; }
                        .total { text-align: right; font-size: 18px; font-weight: bold; margin-top: 20px; }
                        .footer { margin-top: 40px; text-align: center; color: #666; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>FATURA</h1>
                        <p>N√∫mero ${fatura.numero}</p>
                    </div>
                    
                    <div class="company-info">
                        <h3>${db.empresa.nome || 'Sua Empresa'}</h3>
                        <p>${db.empresa.cnpj ? 'CNPJ: ' + db.empresa.cnpj + '<br>' : ''}
                        ${db.empresa.endereco || 'Endere√ßo'}<br>
                        ${db.empresa.bairro ? db.empresa.bairro + ' - ' : ''}${db.empresa.cidade || 'Cidade'}-${db.empresa.estado || 'UF'} ${db.empresa.cep || ''}<br>
                        ${db.empresa.email || 'email@empresa.com'}<br>
                        ${db.empresa.telefone || 'Telefone'}</p>
                    </div>
                    
                    <div class="client-info">
                        <h3>Cliente</h3>
                        <p><strong>${cliente ? cliente.nome : '-'}</strong><br>
                        ${cliente && cliente.documento ? 'CNPJ/CPF: ' + cliente.documento + '<br>' : ''}
                        ${cliente && cliente.endereco ? cliente.endereco + '<br>' : ''}
                        ${cliente && cliente.email ? cliente.email + '<br>' : ''}
                        ${cliente && cliente.telefone ? cliente.telefone : ''}</p>
                    </div>
                    
                    <div>
                        <p><strong>Data de Emiss√£o:</strong> ${formatDate(fatura.dataEmissao)}</p>
                        <p><strong>Data de Vencimento:</strong> ${formatDate(fatura.dataVencimento)}</p>
                        <p><strong>Forma de Pagamento:</strong> ${getFormaPagamentoText(fatura.formaPagamento)}</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${fatura.descricao}</td>
                                <td>${formatCurrency(fatura.valor)}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="total">
                        <p>Total: ${formatCurrency(fatura.valor)}</p>
                    </div>
                    
                    <div class="footer">
                        <p>Condi√ß√µes de Pagamento: DEP√ìSITO BANC√ÅRIO</p>
                        <hr style="margin-top: 80px;">
                        <p>Assinatura</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        function getFormaPagamentoText(forma) {
            const texts = {
                'transferencia': 'Dep√≥sito Banc√°rio',
                'pix': 'PIX',
                'boleto': 'Boleto',
                'cartao': 'Cart√£o de Cr√©dito',
                'cripto': 'Criptomoedas'
            };
            return texts[forma] || forma;
        }

        // Contas a Pagar functions
        function saveContaPagar(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const editId = e.target.getAttribute('data-edit-id');
            
            const conta = {
                id: editId ? parseInt(editId) : Date.now(),
                descricao: formData.get('descricao'),
                fornecedor: formData.get('fornecedor'),
                vencimento: formData.get('vencimento'),
                valor: parseFloat(formData.get('valor')),
                categoria: formData.get('categoria'),
                status: 'pendente'
            };
            
            if (editId) {
                const index = db.contasPagar.findIndex(c => c.id === conta.id);
                if (index !== -1) {
                    db.contasPagar[index] = conta;
                }
                showNotification('Conta atualizada com sucesso!');
            } else {
                db.contasPagar.push(conta);
                showNotification('Conta cadastrada com sucesso!');
            }
            
            saveData();
            closeModal('conta-pagar-modal');
            e.target.reset();
            loadContasPagar();
        }

        function loadContasPagar() {
            const tbody = document.querySelector('#contas-pagar-table tbody');
            tbody.innerHTML = '';
            
            db.contasPagar.forEach(conta => {
                tbody.innerHTML += `
                    <tr>
                        <td>${conta.descricao}</td>
                        <td>${conta.fornecedor || '-'}</td>
                        <td>${formatDate(conta.vencimento)}</td>
                        <td>${formatCurrency(conta.valor)}</td>
                        <td><span class="badge badge-${getStatusClass(conta.status)}">${getStatusText(conta.status)}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="editContaPagar(${conta.id})">Editar</button>
                            <button class="btn btn-success" onclick="payBill(${conta.id})">Pagar</button>
                            <button class="btn btn-danger" onclick="deleteBill(${conta.id})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editContaPagar(id) {
            const conta = db.contasPagar.find(c => c.id === id);
            if (!conta) return;

            showModal('conta-pagar-modal');
            document.getElementById('conta-pagar-modal-title').textContent = 'Editar Conta a Pagar';
            const form = document.getElementById('conta-pagar-form');
            form.setAttribute('data-edit-id', id);
            form.descricao.value = conta.descricao;
            form.fornecedor.value = conta.fornecedor || '';
            form.vencimento.value = conta.vencimento;
            form.valor.value = conta.valor;
            form.categoria.value = conta.categoria;
        }

        function payBill(contaId) {
            const conta = db.contasPagar.find(c => c.id === contaId);
            if (conta && confirm('Confirmar pagamento desta conta?')) {
                conta.status = 'pago';
                conta.dataPagamento = new Date().toISOString().split('T')[0];
                saveData();
                loadContasPagar();
                updateDashboard();
                showNotification('Conta marcada como paga!');
            }
        }

        // Contas a Receber
        function loadContasReceber() {
            const tbody = document.querySelector('#contas-receber-table tbody');
            tbody.innerHTML = '';
            
            db.faturas.filter(f => f.status === 'pendente').forEach(fatura => {
                const cliente = db.clientes.find(c => c.id == fatura.clienteId);
                
                tbody.innerHTML += `
                    <tr>
                        <td>${fatura.numero}</td>
                        <td>${cliente ? cliente.nome : '-'}</td>
                        <td>${formatDate(fatura.dataVencimento)}</td>
                        <td>${formatCurrency(fatura.valor)}</td>
                        <td><span class="badge badge-warning">Pendente</span></td>
                        <td>
                            <button class="btn btn-success" onclick="markAsPaid(${fatura.id})">Receber</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Dashboard
        function updateDashboard() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            // Or√ßamentos do m√™s
            const orcamentosDoMes = db.orcamentos.filter(o => {
                const orcDate = new Date(o.data);
                return orcDate.getMonth() === currentMonth && orcDate.getFullYear() === currentYear;
            });
            document.getElementById('orcamentos-mes').textContent = orcamentosDoMes.length;
            
            // Faturas pendentes
            const faturasPendentes = db.faturas.filter(f => f.status === 'pendente');
            document.getElementById('faturas-pendentes').textContent = faturasPendentes.length;
            
            // Total a receber
            const totalReceber = faturasPendentes.reduce((sum, f) => sum + f.valor, 0);
            document.getElementById('total-receber').textContent = formatCurrency(totalReceber);
            
            // Total a pagar
            const contasPendentes = db.contasPagar.filter(c => c.status === 'pendente');
            const totalPagar = contasPendentes.reduce((sum, c) => sum + c.valor, 0);
            document.getElementById('total-pagar').textContent = formatCurrency(totalPagar);
            
            // Total recebido no m√™s
            const faturasPagasMes = db.faturas.filter(f => {
                if (f.status !== 'pago' || !f.dataPagamento) return false;
                const pagDate = new Date(f.dataPagamento);
                return pagDate.getMonth() === currentMonth && pagDate.getFullYear() === currentYear;
            });
            const totalRecebidoMes = faturasPagasMes.reduce((sum, f) => sum + f.valor, 0);
            document.getElementById('total-recebido-mes').textContent = formatCurrency(totalRecebidoMes);
            
            // √öltimos or√ßamentos
            const tbody = document.querySelector('#dashboard-orcamentos tbody');
            tbody.innerHTML = '';
            
            const recentOrcamentos = db.orcamentos.slice(-5).reverse();
            recentOrcamentos.forEach(orcamento => {
                const cliente = db.clientes.find(c => c.id == orcamento.clienteId);
                tbody.innerHTML += `
                    <tr>
                        <td>${orcamento.numero}</td>
                        <td>${cliente ? cliente.nome : '-'}</td>
                        <td>${formatDate(orcamento.data)}</td>
                        <td>${formatCurrency(orcamento.total)}</td>
                        <td><span class="badge badge-${getStatusClass(orcamento.status)}">${getStatusText(orcamento.status)}</span></td>
                    </tr>
                `;
            });
        }

        // PDF Generation for Or√ßamento
        function generateOrcamentoPDF(orcamento) {
            const cliente = db.clientes.find(c => c.id == orcamento.clienteId);
            const dataValidade = new Date(orcamento.data);
            dataValidade.setDate(dataValidade.getDate() + orcamento.validade);
            
            // Create print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Or√ßamento ${orcamento.numero}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .company-info { margin-bottom: 30px; }
                        .client-info { margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f5f5f5; }
                        .total { text-align: right; font-size: 18px; font-weight: bold; margin-top: 20px; }
                        .footer { margin-top: 40px; text-align: center; color: #666; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>OR√áAMENTO</h1>
                        <p>Proposta ${orcamento.numero}</p>
                    </div>
                    
                    <div class="company-info">
                        <h3>${db.empresa.nome || 'Sua Empresa'}</h3>
                        <p>${db.empresa.cnpj ? 'CNPJ: ' + db.empresa.cnpj + '<br>' : ''}
                        ${db.empresa.endereco || 'Endere√ßo'}<br>
                        ${db.empresa.bairro ? db.empresa.bairro + ' - ' : ''}${db.empresa.cidade || 'Cidade'}-${db.empresa.estado || 'UF'} ${db.empresa.cep || ''}<br>
                        ${db.empresa.email || 'email@empresa.com'}<br>
                        ${db.empresa.telefone || 'Telefone'}</p>
                    </div>
                    
                    <div class="client-info">
                        <h3>Cliente</h3>
                        <p><strong>${cliente ? cliente.nome : '-'}</strong><br>
                        ${cliente && cliente.documento ? 'CNPJ/CPF: ' + cliente.documento + '<br>' : ''}
                        ${cliente && cliente.endereco ? cliente.endereco + '<br>' : ''}
                        ${cliente && cliente.email ? cliente.email + '<br>' : ''}
                        ${cliente && cliente.telefone ? cliente.telefone : ''}</p>
                    </div>
                    
                    <div>
                        <p><strong>Data de Envio:</strong> ${formatDate(orcamento.data)}</p>
                        <p><strong>Validade:</strong> ${formatDate(dataValidade)}</p>
                        ${orcamento.prazoEntrega ? '<p><strong>Prazo de Entrega:</strong> ' + orcamento.prazoEntrega + '</p>' : ''}
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                                <th>Qtd</th>
                                <th>Largura</th>
                                <th>Altura</th>
                                <th>M¬≤</th>
                                <th>Valor Unit.</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orcamento.items.map((item, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${item.descricao}</td>
                                    <td>${item.qtd}</td>
                                    <td>${item.largura || '-'}</td>
                                    <td>${item.altura || '-'}</td>
                                    <td>${item.m2 ? item.m2.toFixed(2) : '-'}</td>
                                    <td>${formatCurrency(item.valorUnit)}</td>
                                    <td>${formatCurrency(item.total)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="total">
                        <p>Total: ${formatCurrency(orcamento.total)}</p>
                    </div>
                    
                    ${orcamento.observacoes ? '<div><h4>Observa√ß√µes:</h4><p>' + orcamento.observacoes + '</p></div>' : ''}
                    
                    <div class="footer">
                        <p>Condi√ß√µes de Pagamento: DEP√ìSITO BANC√ÅRIO</p>
                        <hr style="margin-top: 80px;">
                        <p>Assinatura</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // Utility functions
        function formatCurrency(value) {
            return 'R$ ' + value.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }

        function getStatusClass(status) {
            const classes = {
                'pendente': 'warning',
                'aprovado': 'success',
                'pago': 'success',
                'cancelado': 'danger'
            };
            return classes[status] || 'secondary';
        }

        function getStatusText(status) {
            const texts = {
                'pendente': 'Pendente',
                'aprovado': 'Aprovado',
                'pago': 'Pago',
                'cancelado': 'Cancelado'
            };
            return texts[status] || status;
        }

        function showNotification(message) {
            // Simple notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 15px 20px;
                border-radius: 4px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                z-index: 10000;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Delete functions
        function deleteCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                db.clientes = db.clientes.filter(c => c.id !== id);
                saveData();
                loadClientes();
                showNotification('Cliente exclu√≠do com sucesso!');
            }
        }

        function deleteOrcamento(id) {
            if (confirm('Tem certeza que deseja excluir este or√ßamento?')) {
                db.orcamentos = db.orcamentos.filter(o => o.id !== id);
                saveData();
                loadOrcamentos();
                showNotification('Or√ßamento exclu√≠do com sucesso!');
            }
        }

        function deleteFatura(id) {
            if (confirm('Tem certeza que deseja excluir esta fatura?')) {
                db.faturas = db.faturas.filter(f => f.id !== id);
                saveData();
                loadFaturas();
                showNotification('Fatura exclu√≠da com sucesso!');
            }
        }

        function deleteBill(id) {
            if (confirm('Tem certeza que deseja excluir esta conta?')) {
                db.contasPagar = db.contasPagar.filter(c => c.id !== id);
                saveData();
                loadContasPagar();
                showNotification('Conta exclu√≠da com sucesso!');
            }
        }

        // Report functions
        function gerarRelatorioVendas() {
            const faturasPagas = db.faturas.filter(f => f.status === 'pago');
            const totalVendas = faturasPagas.reduce((sum, f) => sum + f.valor, 0);
            
            // Generate PDF for sales report
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Relat√≥rio de Vendas</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f5f5f5; }
                        .total { text-align: right; font-weight: bold; margin-top: 20px; }
                    </style>
                </head>
                <body>
                    <h1>Relat√≥rio de Vendas</h1>
                    <p>Total de Faturas Pagas: ${faturasPagas.length}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>N√∫mero</th>
                                <th>Cliente</th>
                                <th>Data Pagamento</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${faturasPagas.map(f => {
                                const cliente = db.clientes.find(c => c.id == f.clienteId);
                                return `
                                    <tr>
                                        <td>${f.numero}</td>
                                        <td>${cliente ? cliente.nome : '-'}</td>
                                        <td>${formatDate(f.dataPagamento)}</td>
                                        <td>${formatCurrency(f.valor)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    <div class="total">Valor Total: ${formatCurrency(totalVendas)}</div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function gerarFluxoCaixa() {
            const receber = db.faturas.filter(f => f.status === 'pendente').reduce((sum, f) => sum + f.valor, 0);
            const pagar = db.contasPagar.filter(c => c.status === 'pendente').reduce((sum, c) => sum + c.valor, 0);
            const saldo = receber - pagar;
            
            // Generate PDF for cash flow
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Relat√≥rio de Fluxo de Caixa</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .summary { font-size: 18px; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>Relat√≥rio de Fluxo de Caixa</h1>
                    <div class="summary">
                        <p>A Receber: ${formatCurrency(receber)}</p>
                        <p>A Pagar: ${formatCurrency(pagar)}</p>
                        <p>Saldo Previsto: ${formatCurrency(saldo)}</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function gerarRelatorioClientes() {
            // Generate PDF for clients report
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Relat√≥rio de Clientes</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f5f5f5; }
                    </style>
                </head>
                <body>
                    <h1>Relat√≥rio de Clientes</h1>
                    <p>Total de Clientes: ${db.clientes.length}</p>
                    <p>Or√ßamentos Emitidos: ${db.orcamentos.length}</p>
                    <p>Faturas Emitidas: ${db.faturas.length}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Documento</th>
                                <th>Email</th>
                                <th>Telefone</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${db.clientes.map(c => `
                                <tr>
                                    <td>${c.nome}</td>
                                    <td>${c.documento || '-'}</td>
                                    <td>${c.email || '-'}</td>
                                    <td>${c.telefone || '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Profile functions
        function loadPerfil() {
            const form = document.getElementById('perfil-form');
            if (db.empresa) {
                form.nome.value = db.empresa.nome || '';
                form.cnpj.value = db.empresa.cnpj || '';
                form.industria.value = db.empresa.industria || 'grafica';
                form.website.value = db.empresa.website || '';
                form.email.value = db.empresa.email || '';
                form.telefone.value = db.empresa.telefone || '';
                form.endereco.value = db.empresa.endereco || '';
                form.bairro.value = db.empresa.bairro || '';
                form.cidade.value = db.empresa.cidade || '';
                form.estado.value = db.empresa.estado || '';
                form.cep.value = db.empresa.cep || '';
                form.pais.value = db.empresa.pais || 'Brasil';
                form.fax.value = db.empresa.fax || '';
                form.prefixo_orcamento.value = db.empresa.prefixo_orcamento || 'N¬∞';
                form.proximo_orcamento.value = db.nextOrcamentoNum || 137703;
                form.proximo_fatura.value = db.nextFaturaNum || 1001;
            }
        }

        function savePerfil(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            db.empresa = {
                nome: formData.get('nome'),
                cnpj: formData.get('cnpj'),
                industria: formData.get('industria'),
                website: formData.get('website'),
                email: formData.get('email'),
                telefone: formData.get('telefone'),
                endereco: formData.get('endereco'),
                bairro: formData.get('bairro'),
                cidade: formData.get('cidade'),
                estado: formData.get('estado'),
                cep: formData.get('cep'),
                pais: formData.get('pais'),
                fax: formData.get('fax'),
                prefixo_orcamento: formData.get('prefixo_orcamento')
            };
            
            const proximoNumOrc = parseInt(formData.get('proximo_orcamento'));
            if (proximoNumOrc && proximoNumOrc > 0) {
                db.nextOrcamentoNum = proximoNumOrc;
            }
            const proximoNumFat = parseInt(formData.get('proximo_fatura'));
            if (proximoNumFat && proximoNumFat > 0) {
                db.nextFaturaNum = proximoNumFat;
            }
            
            saveData();
            showNotification('Perfil da empresa atualizado com sucesso!');
        }

        // Export/Import functions
        function exportData() {
            const dataStr = JSON.stringify(db, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'backup_grafica_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Dados exportados com sucesso!');
        }

        function importData() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (confirm('Isso substituir√° todos os dados atuais. Deseja continuar?')) {
                            db = importedData;
                            saveData();
                            location.reload();
                        }
                    } catch (error) {
                        alert('Erro ao importar arquivo: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            fileInput.click();
        }
    </script>
</body>
</html>
